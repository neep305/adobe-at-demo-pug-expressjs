extends layout

block content
  div(class='container mx-auto px-4 py-8')
    h1(class='text-3xl font-bold mb-8') Checkout
    
    if errors && errors.length > 0
      div(class='bg-red-100 border-l-4 border-red-500 p-4 mb-6')
        ul
          each error in errors
            li(class='text-red-700')= error
    
    form(action='/checkout/process', method='POST')
      div(class='grid grid-cols-1 lg:grid-cols-3 gap-8')
        //- Checkout Form (Adobe Target: checkout-form-fields mbox)
        div(class='lg:col-span-2 space-y-6')
          //- Contact Information
          div(class='bg-white rounded-lg shadow-md p-6')
            h2(class='text-xl font-semibold mb-4') Contact Information
            
            div(class='grid grid-cols-1 md:grid-cols-2 gap-4')
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') First Name *
                input(
                  type='text',
                  name='firstName',
                  value=formData ? formData.firstName : (user.profile.firstName || ''),
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
              
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') Last Name *
                input(
                  type='text',
                  name='lastName',
                  value=formData ? formData.lastName : (user.profile.lastName || ''),
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
            
            div(class='mt-4')
              label(class='block text-sm font-medium text-gray-700 mb-1') Email *
              input(
                type='email',
                name='email',
                value=formData ? formData.email : (user.profile.email || ''),
                required,
                class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
              )
            
            div(class='mt-4')
              label(class='block text-sm font-medium text-gray-700 mb-1') Phone *
              input(
                type='tel',
                name='phone',
                value=formData ? formData.phone : '',
                required,
                class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
              )
          
          //- Shipping Address
          div(class='bg-white rounded-lg shadow-md p-6')
            h2(class='text-xl font-semibold mb-4') Shipping Address
            
            div(class='mb-4')
              label(class='block text-sm font-medium text-gray-700 mb-1') Street Address *
              input(
                type='text',
                name='address',
                value=formData ? formData.address : '',
                required,
                class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
              )
            
            div(class='grid grid-cols-1 md:grid-cols-3 gap-4')
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') City *
                input(
                  type='text',
                  name='city',
                  value=formData ? formData.city : '',
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
              
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') State *
                input(
                  type='text',
                  name='state',
                  value=formData ? formData.state : '',
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
              
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') ZIP Code *
                input(
                  type='text',
                  name='zipCode',
                  value=formData ? formData.zipCode : '',
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
          
          //- Payment Information
          div(class='bg-white rounded-lg shadow-md p-6')
            h2(class='text-xl font-semibold mb-4') Payment Information
            
            div(class='mb-4')
              label(class='block text-sm font-medium text-gray-700 mb-1') Card Number *
              input(
                type='text',
                name='cardNumber',
                placeholder='1234 5678 9012 3456',
                required,
                class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
              )
            
            div(class='grid grid-cols-2 gap-4')
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') Expiry Date *
                input(
                  type='text',
                  name='expiryDate',
                  placeholder='MM/YY',
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
              
              div
                label(class='block text-sm font-medium text-gray-700 mb-1') CVV *
                input(
                  type='text',
                  name='cvv',
                  placeholder='123',
                  required,
                  class='w-full px-4 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500'
                )
        
        //- Order Summary
        div(class='lg:col-span-1')
          div(class='bg-white rounded-lg shadow-md p-6 sticky top-4')
            h2(class='text-xl font-semibold mb-4') Order Summary
            
            //- Cart Items
            div(class='space-y-3 mb-4 max-h-64 overflow-y-auto')
              each item in cart.items
                div(class='flex justify-between items-start text-sm')
                  div(class='flex-1')
                    p(class='font-medium')= item.name
                    p(class='text-gray-500')= `Qty: ${item.quantity}`
                  p(class='font-medium ml-2')= `$${(item.price * item.quantity).toFixed(2)}`
            
            div(class='border-t pt-3 space-y-2')
              div(class='flex justify-between text-sm')
                span(class='text-gray-600') Subtotal
                span= `$${cart.total.toFixed(2)}`
              div(class='flex justify-between text-sm')
                span(class='text-gray-600') Shipping
                span Free
              div(class='flex justify-between text-sm')
                span(class='text-gray-600') Tax
                span= `$${(cart.total * 0.1).toFixed(2)}`
              
              div(class='border-t pt-2 mt-2')
                div(class='flex justify-between text-lg font-bold')
                  span Total
                  span= `$${(cart.total * 1.1).toFixed(2)}`
            
            button(
              type='submit',
              class='w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium mt-4'
            ) Place Order
            
            a(href='/cart' class='block text-center text-blue-600 hover:underline mt-3')
              | ‚Üê Back to Cart
