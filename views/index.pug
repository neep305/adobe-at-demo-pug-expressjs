extends layout

block content
  //- Hero Section - Multi-mode Adobe Target Support
  if targetRenderMode === 'server'
    //- Server-side rendering with SDK
    if heroContent
      section(class='bg-gradient-to-r from-blue-600 to-blue-800 text-white py-20')
        div(class='container mx-auto px-4 text-center')
          != heroContent
    else
      section(class='bg-gradient-to-r from-blue-600 to-blue-800 text-white py-20')
        div(class='container mx-auto px-4 text-center')
          h1(class='text-5xl font-bold mb-4') Welcome to TechStore
          p(class='text-xl mb-8') Discover Premium Electronics & Latest Gadgets
          a(href='/products/search' class='bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 inline-block') Shop Now
  
  else if targetRenderMode === 'client-form'
    //- Client-side Form-Based: custom mbox via at.js
    section#hero-section(class='bg-gradient-to-r from-blue-600 to-blue-800 text-white py-20')
      div(class='container mx-auto px-4 text-center')
        div.mboxDefault
          h1(class='text-5xl font-bold mb-4') Welcome to TechStore
          p(class='text-xl mb-8') Discover Premium Electronics & Latest Gadgets
          a(href='/products/search' class='bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 inline-block') Shop Now
        div#homepage-hero-container
  
  else
    //- Client-side VEC: global mbox (automatic)
    section(class='bg-gradient-to-r from-blue-600 to-blue-800 text-white py-20')
      div(class='container mx-auto px-4 text-center')
        h1(class='text-5xl font-bold mb-4') Welcome to TechStore
        p(class='text-xl mb-8') Discover Premium Electronics & Latest Gadgets
        a(href='/products/search' class='bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 inline-block') Shop Now
  
  //- Featured Products
  section(class='container mx-auto px-4 py-12')
    h2(class='text-3xl font-bold mb-8 text-center') Featured Products
    
    if recommendationsContent
      div(class='mb-6')
        != recommendationsContent

    div(class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6')
      each product in featuredProducts
        include partials/product-card
  
  //- Sale Section
  if saleProducts && saleProducts.length > 0
    section(class='container mx-auto px-4 py-12')
      div(class='bg-red-50 rounded-lg p-8')
        h2(class='text-3xl font-bold mb-8 text-center text-red-600') ðŸ”¥ Limited Time Sale
        
        div(class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6')
          each product in saleProducts
            include partials/product-card
  
  //- Categories Section
  section(class='container mx-auto px-4 py-12')
    h2(class='text-3xl font-bold mb-8 text-center') Shop by Category
    
    div(class='grid grid-cols-2 md:grid-cols-4 gap-6')
      a(href='/products/search?q=laptop' class='bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow')
        div(class='text-4xl mb-2') ðŸ’»
        h3(class='font-semibold') Laptops
      
      a(href='/products/search?q=phone' class='bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow')
        div(class='text-4xl mb-2') ðŸ“±
        h3(class='font-semibold') Phones
      
      a(href='/products/search?q=audio' class='bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow')
        div(class='text-4xl mb-2') ðŸŽ§
        h3(class='font-semibold') Audio
      
      a(href='/products/search?q=wearables' class='bg-white rounded-lg shadow-md p-6 text-center hover:shadow-lg transition-shadow')
        div(class='text-4xl mb-2') âŒš
        h3(class='font-semibold') Wearables

block append-script
  //- Client-side VEC: Manual global mbox trigger
  if targetRenderMode === 'client-vec'
    script.
      // Wait for at.js to load and manually trigger global mbox
      if (typeof adobe !== 'undefined' && adobe.target) {
        console.log('ðŸŽ¯ Manually triggering global mbox for VEC...');
        adobe.target.getOffer({
          mbox: 'target-global-mbox',
          success: function(offer) {
            adobe.target.applyOffer({ 
              mbox: 'target-global-mbox', 
              offer: offer 
            });
            console.log(`âœ… Global mbox manually triggered and applied. { 'offer' : ${JSON.stringify(offer)} }`);
          },
          error: function(status, error) {
            console.error('âŒ Global mbox error:', status, error);
          }
        });
      } else {
        console.warn('âš ï¸ Adobe Target (at.js) not loaded - cannot trigger global mbox');
      }
  
  //- Client-side Form-Based mbox implementation
  else if targetRenderMode === 'client-form'
    script.
      // Wait for at.js to fully initialize before requesting offers
      function requestHomepageHeroOffer() {
        if (typeof adobe !== 'undefined' && 
            adobe.target && 
            typeof adobe.target.getOffer === 'function') {
          
          console.log('ðŸŽ¯ Requesting homepage-hero offer...');
          console.log('   â†’ Settings:', window.targetGlobalSettings);
          console.log('   â†’ URL:', window.location.href);
          
          adobe.target.getOffer({
            mbox: 'homepage-hero',
            params: {
              'at_property': window.targetGlobalSettings.propertyToken || ''
            },
            success: function(offer) {
              console.log('ðŸ“¦ SUCCESS - Received offer:', offer);
              console.log('   â†’ Type:', typeof offer);
              console.log('   â†’ Length:', offer ? offer.length : 'null');
              console.log('   â†’ Content:', JSON.stringify(offer, null, 2));
              
              if (offer && offer.length > 0) {
                adobe.target.applyOffer({
                  mbox: 'homepage-hero',
                  offer: offer,
                  selector: '#homepage-hero-container'
                });
                console.log('âœ… Target homepage-hero offer applied successfully');
              } else {
                console.warn('âš ï¸ EMPTY OFFER - Troubleshooting:');
                console.log('   1. Current URL:', window.location.href);
                console.log('   2. Mbox name: homepage-hero');
                console.log('   3. Client Code:', window.targetGlobalSettings.clientCode);
                console.log('   4. Organization ID:', window.targetGlobalSettings.organizationId);
                console.log('   5. Property Token:', window.targetGlobalSettings.propertyToken || 'none');
                console.log('');
                console.log('   âœ“ Check Target UI:');
                console.log('     - Activity is ACTIVE');
                console.log('     - Activity type is Form-Based Experience Composer');
                console.log('     - Location/mbox name matches: homepage-hero');
                console.log('     - URL targeting includes:', window.location.hostname);
                console.log('     - Audience conditions are met');
              }
            },
            error: function(status, error) {
              console.error('âŒ ERROR - Target request failed');
              console.error('   â†’ Status:', status);
              console.error('   â†’ Error:', error);
            },
            timeout: 5000
          });
        } else {
          console.log('â³ Waiting for at.js initialization...');
          setTimeout(requestHomepageHeroOffer, 100);
        }
      }
      
      // Start request after DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', requestHomepageHeroOffer);
      } else {
        requestHomepageHeroOffer();
      }
  
  //- Additional scripts
  script.
    $(() => {
      console.log('Homepage loaded - Target Mode:', '#{targetRenderMode}');
    });