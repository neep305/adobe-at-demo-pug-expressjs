doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title= title || 'TechStore'
    
    //- Tailwind CSS CDN
    script(src='https://cdn.tailwindcss.com')
    
    //- jQuery CDN
    script(src='https://code.jquery.com/jquery-3.7.1.min.js')

    // targetGlobalSettings for Adobe Target
    script.
      window.targetGlobalSettings = {
        clientCode: '!{targetClientCode}',
        organizationId: '!{organizationId}',
        propertyToken: '!{propertyToken}',
        serverDomain: '!{serverDomain}',
        timeout: 3000,
        pageLoadEnabled: !{targetRenderMode === 'client-vec' ? 'true' : 'false'},
        bodyHidingEnabled: !{targetRenderMode !== 'server' ? 'true' : 'false'},
        authoringScriptUrl: 'https://cdn.tt.omtrdc.net/cdn/target-vec.js'
      };
      console.log('🎯 Target Render Mode:', '!{targetRenderMode}');
      console.log('🔧 Target Global Settings:', window.targetGlobalSettings);
      console.log('📍 Current URL:', window.location.href);

    // prehiding for Adobe Target
    script.
      (function (win, doc, style, timeout) {
        var STYLE_ID = 'at-body-style';

        function getParent() {
          return doc.getElementsByTagName('head')[0];
        }
        function addStyle(parent, id, def) {
          if (!parent) return;
          var el = doc.createElement('style');
          el.id = id;
          el.innerHTML = def;
          parent.appendChild(el);
        }
        function removeStyle(parent, id) {
          if (!parent) return;
          var el = doc.getElementById(id);
          if (!el) return;
          parent.removeChild(el);
        }

        addStyle(getParent(), STYLE_ID, style);
        setTimeout(function () {
          removeStyle(getParent(), STYLE_ID);
        }, timeout);

      })(window, document, 'body {opacity: 0 !important}', 3000);

    
    //- Adobe Target at.js (if configured)
    if atjsPath
      script(src=atjsPath, onload="console.log('✅ at.js loaded successfully');", onerror="console.error('❌ Failed to load at.js');")
    
    //- QA Mode detection
    script.
      var urlParams = new URLSearchParams(window.location.search);
      var qaToken = urlParams.get('at_preview_token');
      if (qaToken) {
        console.log('🔍 QA Mode Detected!');
        console.log('   Preview Token:', qaToken);
        console.log('   Preview Index:', urlParams.get('at_preview_index'));
        console.log('   Listed Activities Only:', urlParams.get('at_preview_listed_activities_only'));
      }
    
  body.bg-gray-50.min-h-screen.flex.flex-col
    //- Header
    include partials/header
    
    //- Main Content
    main.flex-grow
      block content
    
    //- Footer
    include partials/footer

    block append-script